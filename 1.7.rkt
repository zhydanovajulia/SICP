#lang racket
(define (square x)
  (* x x))
(define (good-enough guess prev-guess x)
  (display "[")
  (display guess)
  (display " ")
  (display prev-guess)
  (display " ")
  (display (abs (- guess prev-guess )))
  (display "]")
  ; Не похоже, что в таком виде процедура работает лучше.
  (< (abs (- guess prev-guess )) 0.0000001))

(define (good-enough? guess prev x)
  (display "[")
  (display guess)
  (display " ")
  (display (abs (- (square guess) x)))
  (display "]")
  (< (abs (- (square guess) x)) 0.0000001))

(define (average x y)
  (/ (+ x y) 2))

(define (improve guess x)
  (average guess (/ x guess)))

(define (sqrt-iter guess prev-guess x)
  (if (good-enough? guess prev-guess x)
      guess
      (sqrt-iter (improve guess x) guess x)))

(define (sqrt x)
  (sqrt-iter 1.0 0 x))

;(sqrt 9000)

(* 1.414213562373095 1.414213562373095)
(* 1.4142135623746899 1.4142135623746899)

;sqrt 2
;good-enough?
;[1.0 1.0][1.5 0.25]
;[1.4166666666666665 0.006944444444444198]
;[1.4142156862745097 6.007304882427178e-06]
;[1.4142135623746899 4.510614104447086e-12]
;1.4142135623746899
; x*x = 2.0000000000045106
;------------------------
;good-enough
;[1.0 0 1.0][1.5 1.0 0.5]
;[1.4166666666666665 1.5 0.08333333333333348]
;[1.4142156862745097 1.4166666666666665 0.002450980392156854]
;[1.4142135623746899 1.4142156862745097 2.1238998197947723e-06]
;[1.414213562373095 1.4142135623746899 1.5949463971764999e-12]
;1.414213562373095
; x*x = 1.9999999999999996

;sqrt 9000
;good-enough?
;[1.0 8999.0][4500.5 20245500.25]
;[2251.249888901233 5059126.062277814]
;[1127.6238340550915 1262535.5111291045]
;[567.8026095476013 313399.80340906576]
;[291.82659416897513 76162.76106426372]
;[161.3334133107503 17028.470250497383]
;[108.55925481173495 2785.111805279197]
;[95.7316437061264 164.54760667673145]
;[94.87222251420656 0.7386047851214244]
;[94.8683298849124 1.5152563719311729e-05]
;[94.86832980505139 1.8189894035458565e-12]
;94.86832980505139
;---------------------
;good-enough
;[1.0 0 1.0][4500.5 1.0 4499.5]
;[2251.249888901233 4500.5 2249.250111098767]
;[1127.6238340550915 2251.249888901233 1123.6260548461416]
;[567.8026095476013 1127.6238340550915 559.8212245074902]
;[291.82659416897513 567.8026095476013 275.97601537862613]
;[161.3334133107503 291.82659416897513 130.49318085822483]
;[108.55925481173495 161.3334133107503 52.77415849901536]
;[95.7316437061264 108.55925481173495 12.82761110560854]
;[94.87222251420656 95.7316437061264 0.85942119191985]
;[94.8683298849124 94.87222251420656 0.003892629294156791]
;[94.86832980505139 94.8683298849124 7.986101024926029e-08]
;94.86832980505139